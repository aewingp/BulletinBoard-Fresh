<script>
let posts = [];
let editIndex = null;

function renderPosts() {
  const container = document.getElementById('posts');
  container.innerHTML = '';
  posts.forEach((post, index) => {
    const div = document.createElement('div');
    div.className = 'post';
    div.innerHTML = `
      <strong>${post.title}</strong> (${post.category}) - Exp: ${post.expiration} <br>
      ${post.teaser} <br>
      <button onclick="editPost(${index})">Edit</button>
      <button onclick="deletePost(${index})">Delete</button>
    `;
    container.appendChild(div);
  });
}

function savePosts() {
  fetch('/posts', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(posts)
  }).then(() => renderPosts());
}

function addPost() {
  const newPost = {
    title: document.getElementById('title').value,
    teaser: document.getElementById('teaser').value,
    content: document.getElementById('content').value,
    expiration: document.getElementById('expiration').value,
    category: document.getElementById('category').value,
    tags: document.getElementById('tags').value.split(',').map(t => t.trim()),
    image: document.getElementById('image').value
  };

  if (editIndex !== null) {
    posts[editIndex] = newPost;
    editIndex = null;
  } else {
    posts.push(newPost);
  }

  savePosts();
  document.getElementById('title').value = '';
  document.getElementById('teaser').value = '';
  document.getElementById('content').value = '';
  document.getElementById('expiration').value = '';
  document.getElementById('category').value = 'events';
  document.getElementById('tags').value = '';
  document.getElementById('image').value = '';
}

function deletePost(index) {
  if (confirm('Are you sure you want to delete this post?')) {
    posts.splice(index, 1);
    savePosts();
  }
}

function editPost(index) {
  const post = posts[index];
  editIndex = index;
  document.getElementById('title').value = post.title;
  document.getElementById('teaser').value = post.teaser;
  document.getElementById('content').value = post.content;
  document.getElementById('expiration').value = post.expiration;
  document.getElementById('category').value = post.category;
  document.getElementById('tags').value = post.tags.join(', ');
  document.getElementById('image').value = post.image;
}

fetch('/posts')
  .then(res => res.json())
  .then(data => {
    posts = data;
    renderPosts();
  });

document.getElementById('add-post').addEventListener('click', addPost);
</script>

</body>
</html>